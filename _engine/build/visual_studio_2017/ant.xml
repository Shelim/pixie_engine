<project name="game" basedir="../..">

<!-- These are provided by target solution -->

	<property name="app_unix_name" value="empty" />
	
<!-- Paths -->
	<property name="build_app_path" value="../${app_unix_name}/" />
	<property name="build_vs_path" value="${build_app_path}project/visual_studio_2017" />
	<property name="build_manifest_path" value="${build_app_path}/manifest" />
	<property name="update_vs_solution_script" location="build/visual_studio_2017/update_vs_solution.js" />

<!-- Loading manifest... -->
	
	<xmlproperty file="${build_app_path}manifest/_common/common/manifest.xml" />

<!-- End of initalization -->

	<target name="replace_variables">
		<replace token="$EMPTY_UNIX_NAME$" value="${app_unix_name}"><fileset dir="${replace_variables.file}" /></replace>
		<replace token="$EMPTY_NAME$" value="${manifest.full_name}"><fileset dir="${replace_variables.file}" /></replace>
	</target>
	
	<target name="copy_vs_project">
		<copy todir="${build_vs_path}" preservelastmodified="true" overwrite="true">
			<fileset dir="build/visual_studio_2017/${copy_vs_project.type}"/>
			<mapper>
				<mapper type="regexp" from="(.*)\$EMPTY_UNIX_NAME\$(.*)" to="\1${copy_vs_project.unix_name}\2"/>
				<mapper type="identity"/>
			</mapper>
		</copy>
		<replace token="$EMPTY_UNIX_NAME$" value="${copy_vs_project.unix_name}"><fileset dir="${build_vs_path}" /></replace>
	</target>
	
<!-- Updates VS solution -->
	<target name="update_vs_solution">
		<delete dir="${build_vs_path}" failonerror="false" />
		<mkdir dir="${build_vs_path}" />
		<copy todir="${build_vs_path}" preservelastmodified="true" overwrite="true">
			<fileset dir="build/visual_studio_2017/bare"/>
			<mapper>
				<mapper type="regexp" from="(.*)\$EMPTY_UNIX_NAME\$(.*)" to="\1${app_unix_name}\2"/>
				<mapper type="regexp" from="(.*)\$EMPTY_NAME\$(.*)" to="\1${manifest.full_name}\2"/>
				<mapper type="identity"/>
			</mapper>
		</copy>
		<antcall target="replace_variables">
			<param name="replace_variables.file" value="${build_vs_path}" />
		</antcall>
		
		<script language="javascript" src="${update_vs_solution_script}" />
		
	</target>
	
</project>